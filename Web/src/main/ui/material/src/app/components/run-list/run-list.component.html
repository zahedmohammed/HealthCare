<div class="box box-default">
    <div>
        <article>
            <section class="container-fluid with-maxwidth no-breadcrumbs chapter">
                <a href="javascript:;" [routerLink]="['/app/projects', project.id, 'jobs']"> {{project.name}} </a>
                &nbsp;<span class="text-muted">&nbsp;<i class="fa fa-chevron-right text-muted"></i>&nbsp;</span> &nbsp;
                <a href="javascript:;" [routerLink]="['/app/projects', project.id, 'jobs']">Jobs</a>
                &nbsp;<span class="text-muted">&nbsp;<i class="fa fa-chevron-right text-muted"></i>&nbsp;</span>
                &nbsp;{{job.name}}
                &nbsp;<span class="text-muted">&nbsp;<i class="fa fa-chevron-right text-muted"></i>&nbsp;</span>
                &nbsp;Runs
            </section>
        </article>
    </div>
</div>
<!-- <pre>{{list | json}}</pre> -->
<section class="container-fluid with-maxwidth no-breadcrumbs chapter">
    <article class="article">
        <mat-tab-group (selectedTabChange)="getAnalyticsData()">
            <mat-tab label="Runs">
                <div class="box box-default mt-4">
                    <div class="box-body">
                        <section class="box box-transparent">
                            <div class="box-body">
                                <div class="article-title-style">
                                    <div class="mat-elevation-z8 box-default">
                                        <mat-table [dataSource]="dataSource" matSort matSortActive="no"
                                            matSortDisableClear matSortDirection="desc">
                                            <!-- Region Column -->
                                            <ng-container matColumnDef="region">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Region
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element"> {{element.regions}} </mat-cell>
                                            </ng-container>
                                            <!-- Date Column -->
                                            <ng-container matColumnDef="date">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Date
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element"> {{element.createdDate |
                                                    date:'short'}}
                                                </mat-cell>
                                            </ng-container>
                                            <!-- Pass/Fail Column -->
                                            <ng-container matColumnDef="passfail">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Pass/Fail
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element">
                                                    <span class="text-success h6"><b>{{element.task.totalTestCompleted
                                                            ||
                                                            0}}</b></span>&nbsp;<span class="text-success small">Passed</span>&nbsp;
                                                    <span *ngIf="element.task.failedTests != 0"><span class="text-danger h6"><b>{{element.task.failedTests
                                                                || 0}}</b></span>&nbsp;<span class="text-danger small">Failed</span>&nbsp;</span>
                                                </mat-cell>
                                            </ng-container>
                                            <!-- Success Column -->
                                            <ng-container matColumnDef="success">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Sucess
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element">
                                                    {{ ( (element.task.totalTestCompleted ) /
                                                    (element.task.totalTestCompleted +
                                                    element.task.failedTests) ) | percent}}
                                                </mat-cell>
                                            </ng-container>

                                            <!-- Data Column -->
                                            <ng-container matColumnDef="data">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Data
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element">
                                                    {{element.task.totalBytes | byteFormat}}
                                                </mat-cell>
                                            </ng-container>

                                            <!-- Total Time Column -->
                                            <ng-container matColumnDef="totaltime">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Total Time
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element"> {{element.task.totalTime |
                                                    mstoDuration}} </mat-cell>
                                            </ng-container>

                                            <!-- Bugs Column -->
                                            <ng-container matColumnDef="bugs">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Bugs
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element">
                                                    <div *ngIf="element.job.issueTrackerToDo === false">
                                                        <span class="text-danger"><b>{{element.task.issuesLogged || 0}}</b></span>
                                                        <span class="text-danger small">New</span>&nbsp;
                                                        <span class="text-success"><b>{{element.task.issuesClosed ||
                                                                0}}</b></span>
                                                        <span class="text-success small">Closed</span>
                                                        <span class="text-danger"><b>{{element.task.totalOpenIssues ||
                                                                0}}</b></span>
                                                        <span class="text-danger small">Open</span>
                                                    </div>
                                                </mat-cell>
                                            </ng-container>

                                            <ng-container matColumnDef="bugs2">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header></mat-header-cell>
                                                <mat-cell *matCellDef="let element">
                                                    <div *ngIf="element.job.issueTrackerToDo === true">
                                                        <span class="text-danger"> N/A </span>
                                                    </div>
                                                </mat-cell>
                                            </ng-container>

                                            <!-- Status Column -->

                                            <ng-container matColumnDef="status">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Status
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element">
                                                    <span *ngIf="element.task.status == 'COMPLETED'" class="text-success">{{element.task.status}}</span>
                                                    <span *ngIf="element.task.status != 'COMPLETED' && element.task.status != 'PROCESSING'"
                                                        class="text-danger">{{element.task.status}}</span>
                                                    <span *ngIf="element.task.status == 'PROCESSING'" class="text-warning"><i
                                                            class="fa fa-spinner fa-spin" aria-hidden="true"></i>
                                                        {{element.task.status}}</span>
                                                </mat-cell>
                                            </ng-container>

                                            <!-- Number Column -->
                                            <ng-container matColumnDef="no">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> No
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element">
                                                    <button mat-button class="text-left" color="primary" [routerLink]="['/app/projects' , projectId, 'jobs' , job.id, 'runs', element.id]">{{element.runId}}</button>
                                                </mat-cell>
                                            </ng-container>


                                            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                                            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
                                        </mat-table>
                                        <mat-paginator [hidden]="length <= pageSize" [pageSize]="pageSize" hidePageSize="true"
                                            (page)="change($event)" [length]="length">
                                        </mat-paginator>

                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="Analytics">
                <div class="box box-default mt-4">
                    <section class="box-body">
                        <div class="row article-title-style">
                            <div class="col-xl-6">
                                <div class="box box-default">
                                    <div class="box-body mat-elevation-z8">
                                        <p class="text-dark font-weight-bold">Passed & Failed Analytics</p>
                                        <div *ngIf="graph1">
                                            <canvas id="canvasGraph1">{{ graph1 }}</canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-6">
                                <div class="box box-default">
                                    <div class="box-body mat-elevation-z8">
                                        <p class="text-dark font-weight-bold">Issues Analytics</p>
                                        <div *ngIf="graph2">
                                            <canvas id="canvasGraph2">{{ graph2 }}</canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-6">
                                <div class="box box-default">
                                    <div class="box-body mat-elevation-z8">
                                        <p class="text-dark font-weight-bold">Data Analytics</p>
                                        <div *ngIf="graph3">
                                            <canvas id="canvasGraph3">{{ graph3 }}</canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-6">
                                <div class="box box-default">
                                    <div class="box-body mat-elevation-z8">
                                        <p class="text-dark font-weight-bold">Time Analytics</p>
                                        <div *ngIf="graph4">
                                            <canvas id="canvasGraph4">{{ graph4 }}</canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </mat-tab>
            <mat-tab label="AutoSuggest">
                <div class="box box-default mt-4">
                    <div class="box-body">
                        <section class="box box-transparent">
                            <div class="box-body">
                                <div class="row article-title-style">
                                    <div class="mat-elevation-z8 box-default">

                                        <mat-table [dataSource]="autoSuggestDS" matSort matSortActive="no"
                                            matSortDisableClear matSortDirection="desc">

                                            <!-- ['testSuiteName', 'endPoint', 'method', 'category', 'issueDesc','estimates','suggestion'] -->
                                            <!-- Column testSuiteName-->
                                            <ng-container matColumnDef="testSuiteName">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Suite Name
                                                </mat-header-cell>
                                                <!--<mat-cell *matCellDef="let element" matTooltip="{{element.testSuiteName}}" matTooltipPosition="above"> {{element.testSuiteName | slice:0:15}}... </mat-cell>-->
                                                <mat-cell *matCellDef="let element" matTooltip="{{element.testSuiteName}}"
                                                    matTooltipPosition="above"> {{element.testSuiteName| slice:0:25}}</mat-cell>
                                            </ng-container>

                                            <!-- Column category-->
                                            <ng-container matColumnDef="category">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Category
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element" style="overflow: initial;">
                                                    {{element.category}} </mat-cell>
                                            </ng-container>

                                            <!-- Column endPoint-->
                                            <ng-container matColumnDef="endPoint">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> End Point
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element"> {{element.method}}:
                                                    {{element.endPoint}} </mat-cell>
                                            </ng-container>

                                            <!-- Column method-->
                                            <!--
                                                                                        <ng-container matColumnDef="method">
                                                                                            <mat-header-cell *matHeaderCellDef mat-sort-header> Method
                                                                                            </mat-header-cell>
                                                                                            <mat-cell *matCellDef="let element"> {{element.method}} </mat-cell>
                                                                                        </ng-container>
                                            -->


                                            <!-- Column issueDesc-->
                                            <ng-container matColumnDef="issueDesc">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Description
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element"> {{element.issueDesc}} </mat-cell>
                                            </ng-container>

                                            <!-- Column suggestion-->
                                            <ng-container matColumnDef="suggestion">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header> Suggestion
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let element"> {{element.suggestion}} <br />
                                                    <b>Effort Estimates: </b> {{element.estimates}}
                                                </mat-cell>
                                            </ng-container>

                                            <mat-header-row *matHeaderRowDef="autoSuggestColumns"></mat-header-row>
                                            <mat-row *matRowDef="let row; columns: autoSuggestColumns;"></mat-row>
                                        </mat-table>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
    </article>
</section>