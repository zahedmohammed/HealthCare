<div class="box box-default">
  <div>
    <article>
      <section class="container-fluid with-maxwidth no-breadcrumbs chapter">
        <a href="javascript:;" [routerLink]="['/app/projects']"> Projects </a>
        &nbsp;<span class="text-muted"> > </span> &nbsp;
        <a href="javascript:;" [routerLink]="['/app/projects', id, 'jobs']">{{project.name}}</a>
        &nbsp;<span class="text-muted"> > </span> &nbsp;
        <a href="javascript:;" [routerLink]="['/app/projects', id, 'jobs']"> Jobs </a>
        &nbsp;<span class="text-muted"> > </span> &nbsp;{{job.name}} &nbsp;
        <span class="text-muted"> > </span> &nbsp;Edit
      </section>
    </article>
  </div>
</div>

<!-- <div class="box box-default">
  <div class="box-body">
    <a href="javascript:;" [routerLink]="['/app/projects', id, 'jobs', 'new']"> Projects </a> 
    &nbsp;<span class="text-muted"> > </span> &nbsp;
    <a href="javascript:;" [routerLink]="['/app/projects', id, 'jobs']">{{project.name}}</a>
    &nbsp;<span class="text-muted"> > </span> &nbsp;
    <a href="javascript:;" [routerLink]="['/app/projects', id, 'jobs']"> Jobs </a>
    &nbsp;<span class="text-muted"> > </span> &nbsp;
    &nbsp; New
  </div>
</div> -->

<section class="container-fluid with-maxwidth chapter">

  <mat-toolbar class="rounded">
    <span style="flex: 1 1 auto;"></span>
    <button mat-raised-button color="primary" class="float-right" (click)="cloneJob()">
        Clone </button>&nbsp;&nbsp;
    <small class="space">Jobs</small> &nbsp;&nbsp;
    <a href="javascript:;" [routerLink]="['/app/projects', id, 'environments']">
        <small>Environments</small>
    </a> &nbsp;&nbsp;
    <a href="javascript:;" [routerLink]="['/app/projects', id, 'test-suites']">
        <small>Test Suites</small>
    </a> &nbsp;&nbsp;
    <a href="javascript:;" [routerLink]="['/app/projects', id, 'api-coverage']">
      <small>Coverage</small>
    </a> &nbsp;&nbsp;

    <a href="javascript:;" [routerLink]="['/app/projects', id, 'manage']">
        <small>Edit</small>
    </a> &nbsp;&nbsp;
</mat-toolbar>

  <article class="article">
    <div class="box box-default">
      <div class="box-body">
        <mat-horizontal-stepper [linear]="true" #stepper>

          <mat-step [stepControl]="firstFormGroup">
            <form [formGroup]="firstFormGroup">
              <ng-template matStepLabel>Job Details</ng-template>

              <div class="form-group row"></div>
              <div class="form-group row">
                <label for="name" class="col-md-0 control-label"></label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input required [(ngModel)]="job.name" formControlName="nameCtrl" id="name" matInput placeholder="Job name" autocomplete="off">
                    <mat-error>Required</mat-error>
                  </mat-input-container>
                </div>
                <div class="col-md-7">
                  <div class="callout1 text-muted callout-info1">
                    <p class="mt-4"> e.g. Dev, Stg, QA, UAT, or Nightly etc
                    </p>
                  </div>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-0 control-label">
                </label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input required [(ngModel)]="job.environment.name" [ngModelOptions]="{standalone: true}" matInput placeholder="Environment"
                      autocomplete="off">
                    <mat-error>Required</mat-error>
                  </mat-input-container>
                  <!--<mat-form-field class="full-width">-->
                  <!--<mat-select placeholder="Environment"-->
                  <!--[(ngModel)]="job.environment" [ngModelOptions]="{standalone: true}">-->
                  <!--<mat-option *ngFor="let env of envs" [value]="env">-->
                  <!--{{env.name}}-->
                  <!--</mat-option>-->
                  <!--</mat-select>-->
                  <!--</mat-form-field>-->
                </div>

              </div>

              <div class="form-group row">
                <label for="name" class="col-md-0 control-label"></label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input required [(ngModel)]="job.regions" [ngModelOptions]="{standalone: true}" [matAutocomplete]="autoRegions" matInput
                      placeholder="Bot Region">
                    <mat-error>Required</mat-error>
                  </mat-input-container>
                  <mat-autocomplete #autoRegions="matAutocomplete">
                    <mat-option *ngFor="let option of regions" [value]="option">
                      {{option}}
                    </mat-option>
                  </mat-autocomplete>
                </div>
              </div>

              <div class="form-group row">
                <label for="name" class="col-md-0 control-label"></label>
                <div class="col-md-5">
                  <mat-form-field class="full-width">
                    <mat-select placeholder="Test Categories (Optional)" [(ngModel)]="category" [value]="selectedCategories" name="category"
                      [ngModelOptions]="{standalone: true}" multiple>
                      <mat-option *ngFor="let category of categories" [value]="category">
                        {{category}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>

              <div class="form-group row">
                <label for="name" class="col-md-0 control-label"></label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input [(ngModel)]="job.cron" [ngModelOptions]="{standalone: true}" [matAutocomplete]="auto" matInput placeholder="Cron Expression (Optional)">
                  </mat-input-container>
                  <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let option of crons" [value]="option.exp">
                      {{option.exp}} - <small>{{option.desc}}</small>
                    </mat-option>
                  </mat-autocomplete>
                </div>
              </div>

              <div>
                <mat-card-actions class="pull-right">
                  <button mat-raised-button color="primary" class="nav-btn" [disabled]="firstFormGroup.invalid" matStepperNext>Next
                  </button>
                </mat-card-actions>
              </div>
            </form>
          </mat-step>

          <mat-step [stepControl]="secondFormGroup">
            <form [formGroup]="secondFormGroup">
              <ng-template matStepLabel>Auto Bug Management</ng-template>

              <div class="form-group row">
                <label class="col-md-0 control-label">
                </label>
                <div class="col-md-5">
                  <mat-form-field class="full-width">
                    <mat-select placeholder="Issue Tracker Type (Optional)" [(ngModel)]="job.issueTracker.accountType" name="type" [ngModelOptions]="{standalone: true}">
                      <mat-option *ngFor="let type of accountTypes" [value]="type" (click)="getITAccountsByAccountType();">
                        {{type}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>

              <div class="form-group row" *ngIf="job.issueTracker.accountType === 'GitHub' || job.issueTracker.accountType === 'Jira'">
                <label class="col-md-0 control-label">
                </label>
                <div class="col-md-5">
                  <mat-form-field class="full-width">
                    <mat-select placeholder="Credentials (Optional)" [(ngModel)]="job.issueTracker.account" [ngModelOptions]="{standalone: true}">
                      <mat-option *ngFor="let account of itAccounts" [value]="account.id">
                        {{account.name}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-md-7">
                  <div class="callout1 text-muted callout-info1">
                    <p>
                      <button mat-raised-button class="btn-w-md text-primary" (click)="openDialogITCredentials()"><i class="fa fa-plus"></i>&nbsp;&nbsp;
                        New Credentials</button>
                      <br/> A user with read/write access to the Issue Tracker. <br/> Note: You can create a new 'FX' user
                      with read/write access to the test repository.
                    </p>
                  </div>
                </div>

              </div>

              <div class="form-group row">
                <label for="name" class="col-md-0 control-label"></label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input [(ngModel)]="job.issueTracker.url" [ngModelOptions]="{standalone: true}" matInput placeholder="Issue-Tracker URL (Optional)">
                  </mat-input-container>
                </div>
                <div class="col-md-7">
                  <div class="callout1 text-muted callout-info1">
                    <p class="mt-4">e.g. https://github.com/username/MyApp OR https://mycompany.atlassian.net/
                      <br/>Upon running the job, FX will automatically create/update/close bugs in this Issue Tracker
                    </p>
                  </div>
                </div>
              </div>

              <div class="form-group row" *ngIf="job.issueTracker.accountType === 'Jira'">
                <label for="jiraProjectKey" class="col-md-0 control-label">
                </label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input required [(ngModel)]="job.issueTracker.projectKey" [ngModelOptions]="{standalone: true}" name="jiraProjectKey" id="jiraProjectKey"
                      matInput type="text" placeholder="Projec Key">
                  </mat-input-container>
                </div>
              </div>

              <div>
                <mat-card-actions class="pull-right">
                  <button mat-raised-button color="primary" class="nav-btn" [disabled]="secondFormGroup.invalid" matStepperNext>Next
                  </button>
                </mat-card-actions>
                <button class="pull-right" mat-button matStepperPrevious>Back</button>
              </div>
            </form>
          </mat-step>

          <mat-step [stepControl]="thirdFormGroup">
            <form [formGroup]="thirdFormGroup">
              <ng-template matStepLabel>Notifications</ng-template>

              <div class="form-group row">
                <label for="name" class="col-md-0 control-label"></label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input [(ngModel)]="job.notifications[0].to" [ngModelOptions]="{standalone: true}" matInput placeholder="Emails (Optional)">
                  </mat-input-container>
                </div>
                <div class="col-md-7">
                  <div class="callout1 text-muted callout-info1">
                    <p class="mt-4">Comma separated email addresses, for FX to send the Job Run report. e.g. me@company.com,
                      team@company.com etc</p>
                  </div>
                </div>

              </div>
              <hr>
              <div class="form-group row">
                <label class="col-md-0 control-label">
                </label>
                <div class="col-md-5">
                  <mat-form-field class="full-width">
                    <mat-select placeholder="Slack Credentials (Optional)" [(ngModel)]="job.notifications[1].account" [ngModelOptions]="{standalone: true}">
                      <mat-option *ngFor="let account of notifyAccounts" [value]="account.id">
                        {{account.name}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-md-7">
                  <div class="callout1 text-muted callout-info1">
                    <p>
                      <button mat-raised-button class="btn-w-md text-primary" (click)="openDialogSlackRegister()"><i class="fa fa-plus"></i>&nbsp;&nbsp;
                        New Credentials</button>
                      <br/> Slack token of your slack workspace.<br/>
                    </p>
                  </div>
                </div>
              </div>

              <div class="form-group row">
                <label for="name" class="col-md-0 control-label"></label>
                <div class="col-md-5">
                  <mat-input-container class="full-width">
                    <input [(ngModel)]="job.notifications[1].channel" [ngModelOptions]="{standalone: true}" matInput placeholder="Slack Channel (Optional)">
                  </mat-input-container>
                </div>
                <div class="col-md-7">
                  <div class="callout1 text-muted callout-info1">
                    <p class="mt-4">A Channel in your slack workspace e.g. Engineering, QA etc., for FX to send the Job Run
                      report.</p>
                  </div>
                </div>
              </div>



              <div>
                <div>
                  <mat-card-actions class="pull-right">
                    <button mat-button color="warn" class="nav-btn" (click)="delete();">Delete
                    </button>
                    <button mat-button matStepperPrevious>Back</button>
                    <button mat-raised-button color="primary" class="nav-btn" [disabled]="thirdFormGroup.invalid" (click)="saveJob();">Save
                      & Complete
                    </button>
                  </mat-card-actions>
                </div>
              </div>
            </form>
          </mat-step>

        </mat-horizontal-stepper>

      </div>
    </div>
  </article>
</section>